# 網路通訊原理 (Network Communication Principles) 完整題目解析 - 申論題答題框架

這份文件針對**網路通訊原理**相關題目提供詳盡的申論題答題架構，涵蓋 TCP/IP、OSI 模型、子網路切割、DNS、路由協定、5G/無線網路等核心考點。

---

## 📊 題目總覽

根據分析，在歷年資通安全考題中：

### 題目統計

| 統計項目 | 數量 |
|---------|------|
| **分析考卷總數** | **24 份** |
| **網路通訊原理相關題目** | **72 題** (完整收錄) |
| **高考三級+近三年出現次數** | 28 次 |
| **重要性排名** | **No. 1** (最重要考點，題數最多) |

### 題型分類

| 題型 | 占比 | 代表題目 | 難度 |
|------|------|---------|------|
| **TCP/IP 協定疊 & OSI 模型** | 25% | 各層功能、協定範例、封裝過程 | ⭐⭐⭐ |
| **子網路切割 (Subnetting)** | 20% | CIDR、子網路遮罩計算、IP 分配 | ⭐⭐⭐⭐ |
| **傳輸層協定 (TCP/UDP)** | 15% | TCP三方握手、UDP特性、埠號 | ⭐⭐⭐⭐ |
| **應用層協定 (DNS/HTTP/DHCP)** | 15% | DNS查詢、HTTP/HTTPS、DHCP運作 | ⭐⭐⭐ |
| **NAT & IP 定址** | 10% | NAT原理、IPv4 vs IPv6、私有IP | ⭐⭐⭐ |
| **路由與網路設備** | 10% | 路由表、Switch vs Router、VLAN | ⭐⭐⭐⭐ |
| **新興網路技術** | 5% | SDN、5G、IPv6 | ⭐⭐⭐⭐⭐ |

---

## 🎯 網路通訊原理申論題答題黃金架構

### 通用架構 (適用於網路原理類題目)

```
第一部分：協定/技術定義 (15%)
├─ 定義關鍵術語 (如 TCP, OSI, Subnetting)
├─ 說明在網路架構中的定位 (哪一層)
└─ 闡述主要目的與功能

第二部分：運作原理或計算過程 (50%)
├─ 詳細說明運作流程 (Step 1, Step 2...)
├─ 繪製流程圖或封包格式 (可選)
├─ 進行計算 (如子網路切割、IP範圍)
└─ 舉例說明實際應用

第三部分：優缺點或差異比較 (20%)
├─ 列舉優點與缺點
├─ 與其他協定/技術比較 (如TCP vs UDP)
└─ 說明適用情境

第四部分：實務應用與安全考量 (15%)
├─ 實際應用場景
├─ 可能面臨的攻擊 (如SYN Flood)
└─ 安全強化措施
```

---

## 📚 【核心知識】網路通訊原理完全解析

### 一、TCP/IP 模型 vs OSI 模型

**TCP/IP 四層模型**：

| 層級 | 名稱 | 功能 | 常見協定 |
|------|------|------|----------|
| 4 | **應用層** | 提供網路服務給應用程式 | HTTP, FTP, DNS, SMTP |
| 3 | **傳輸層** | 端對端資料傳輸、流量控制 | TCP, UDP |
| 2 | **網際網路層** | 封包路由、邏輯定址 | IP, ICMP, ARP |
| 1 | **網路存取層** | 實體傳輸、訊框封裝 | Ethernet, WiFi |

**OSI 七層模型**：

| 層級 | 名稱 | 記憶口訣 (由下而上) |
|------|------|---------------------|
| 7 | 應用層 (Application) | **A**ll |
| 6 | 表現層 (Presentation) | **P**eople |
| 5 | 會議層 (Session) | **S**eem |
| 4 | 傳輸層 (Transport) | **T**o |
| 3 | 網路層 (Network) | **N**eed |
| 2 | 資料連結層 (Data Link) | **D**ata |
| 1 | 實體層 (Physical) | **P**rocessing |

### 二、子網路切割 (Subnetting)

**CIDR 表示法**：
- `/24` = Subnet Mask `255.255.255.0` (254 個可用主機)
- `/27` = Subnet Mask `255.255.255.224` (30 個可用主機)
- `/30` = Subnet Mask `255.255.255.252` (2 個可用主機，常用於點對點連線)

**子網路切割公式**：
- **可容納子網路數**：2^n (n = 借用的位元數)
- **每子網路可用主機數**：2^h - 2 (h = 主機位元數，-2 扣除網路位址與廣播位址)

### 三、TCP vs UDP

| 特性 | TCP | UDP |
|------|-----|-----|
| **可靠性** | 可靠 (保證送達) | 不可靠 (Best Effort) |
| **連線** | 連線導向 (三方握手) | 無連線 |
| **順序** | 保證順序 | 不保證 |
| **速度** | 較慢 (額外開銷) | 快速 |
| **應用** | HTTP, FTP, Email | DNS, 串流, 遊戲 |

**TCP 三方握手 (3-Way Handshake)**：
1. Client → Server: SYN
2. Server → Client: SYN-ACK
3. Client → Server: ACK

### 四、DNS 運作原理

**DNS 查詢類型**：
1. **遞迴查詢 (Recursive Query)**：DNS 伺服器代為完整查詢
2. **迭代查詢 (Iterative Query)**：DNS 伺服器回傳下一個查詢目標

**DNS 查詢流程 (查詢 www.example.com)**：
1. 查詢本機 DNS Cache
2. 查詢本機 ISP DNS
3. 查詢根伺服器 (Root Server) `.`
4. 查詢頂級網域伺服器 (TLD Server) `.com`
5. 查詢權威伺服器 (Authoritative Server) `example.com`
6. 回傳 IP 位址

---

## 📝 完整題目解析

> **說明**：以下題目按年份由新到舊排列，每題含：【題目原文】→【答題策略】→【標準答案】→【評分標準】→【補充說明】

---

## 【近三年題目】112-114年

### 題目 1：Internet 通訊協定疊 (Protocol Stack)

#### 📖 原題 (114年關務特考、身心障礙特考、國軍轉任特考三等)

> **題目**：說明 Internet 通訊協定疊（protocol stack），並分別說明各層提供的服務。除最底的第一層外，其他每一層請列舉一個通訊協定。（25 分）

#### 🎯 答題架構分析

1. **定義**：說明 Protocol Stack 是 TCP/IP 模型
2. **四層說明**：由上而下或由下而上說明各層功能
3. **協定舉例**：每層列舉 1-2 個代表性協定
4. **補充**：可加上封裝 (Encapsulation) 概念

#### 📊 評分建議 (預估配分 25 分)

**定義與概念（5 分）**：
- Protocol Stack 定義（2 分）
- 分層架構優點說明（3 分）

**各層服務說明（16 分）**：
- 第一層：網路存取層（4 分）
  - 服務說明（2 分）
  - 不需列舉協定（題目要求）（2 分）
- 第二層：網際網路層（4 分）
  - 服務說明（2 分）
  - 協定舉例：IP（2 分）
- 第三層：傳輸層（4 分）
  - 服務說明（2 分）
  - 協定舉例：TCP 或 UDP（2 分）
- 第四層：應用層（4 分）
  - 服務說明（2 分）
  - 協定舉例：HTTP、DNS 等（2 分）

**補充說明（4 分）**：
- 封裝/解封裝概念（2 分）
- 層間互動機制（2 分）

**答題提示**：
- ✅ 題目要求「除第一層外，其他每層列舉一個協定」→ 至少 3 個協定
- ✅ 每層服務說明要具體，不只列名稱
- ✅ 建議由上（應用層）而下說明，較符合使用者視角
- ⚠️ 注意：題目是 25 分，需寫得詳細充實

#### ✍️ 標準答案示範

**解答**：

**一、Internet 通訊協定疊定義**

Internet 通訊協定疊 (Protocol Stack) 通常指 **TCP/IP 參考模型**，是一套分層架構的網路通訊協定組合，將複雜的網路通訊功能**模組化**，每一層負責特定功能，層與層之間透過標準介面溝通，達到**關注點分離 (Separation of Concerns)** 的設計原則。

**分層架構優點**：
- **模組化**：各層獨立開發與維護
- **互通性**：不同廠商設備可相容
- **靈活性**：可抽換特定層而不影響其他層

**二、TCP/IP 四層模型各層服務說明**

**第一層：網路存取層 (Network Access Layer / Link Layer)**

**提供的服務**：
- 負責與實體網路硬體的介接
- 將資料封裝成**訊框 (Frame)**
- 透過實體媒介 (光纖、雙絞線、無線電波) 傳送
- 處理**實體定址 (MAC Address)**
- 錯誤偵測 (CRC 檢查碼)

**協定範例**：
- **Ethernet (乙太網路)**：有線區域網路的主流技術
- **Wi-Fi (IEEE 802.11)**：無線區域網路

**第二層：網際網路層 (Internet Layer / Network Layer)**

**提供的服務**：
- 負責資料封包 (Packet) 的**邏輯定址 (IP Address)**
- **路由選擇 (Routing)**：決定封包傳送路徑
- 封包分割與重組 (Fragmentation & Reassembly)
- 跨越不同網路到達目的地 (Inter-network)

**協定範例**：
- **IP (Internet Protocol)**：提供不可靠的封包傳遞
- **ICMP (Internet Control Message Protocol)**：錯誤回報與診斷 (如 ping)
- **ARP (Address Resolution Protocol)**：IP 位址轉 MAC 位址

**第三層：傳輸層 (Transport Layer)**

**提供的服務**：
- 提供**端對端 (End-to-End)** 的資料傳輸服務
- **資料分段 (Segmentation)** 與重組
- **流量控制 (Flow Control)**：防止接收端緩衝區溢位
- **壅塞控制 (Congestion Control)**：避免網路癱瘓
- **錯誤檢查與重傳 (Error Detection & Retransmission)**

**協定範例**：
- **TCP (Transmission Control Protocol)**：可靠、連線導向、保證順序
- **UDP (User Datagram Protocol)**：不可靠、無連線、低延遲

**第四層：應用層 (Application Layer)**

**提供的服務**：
- 直接提供網路服務給**應用程式與使用者**
- 處理資料的表示、編碼與格式
- 對話 (Session) 管理
- 應用邏輯實作

**協定範例**：
- **HTTP/HTTPS**：網頁瀏覽
- **DNS (Domain Name System)**：網域名稱解析
- **SMTP (Simple Mail Transfer Protocol)**：電子郵件傳送
- **FTP (File Transfer Protocol)**：檔案傳輸

**三、資料封裝 (Encapsulation) 過程**

當資料從應用層往下傳遞時，每一層都會加上該層的標頭 (Header)：

```
應用層資料 (Data)
  ↓ 加上 TCP Header
[TCP Header | Data] = Segment (區段)
  ↓ 加上 IP Header
[IP Header | TCP Header | Data] = Packet (封包)
  ↓ 加上 Ethernet Header & Trailer
[Eth Header | IP Header | TCP Header | Data | Eth Trailer] = Frame (訊框)
```

接收端則進行**解封裝 (Decapsulation)**，逐層剝除標頭。

**評分標準** (預估)：
- 定義 Protocol Stack：3分
- 四層名稱正確：4分
- 各層服務說明詳細：12分
- 協定舉例正確 (每層1個)：6分

#### 💡 補充說明

**TCP/IP 與 OSI 模型對應**：

| TCP/IP 四層 | OSI 七層 |
|------------|----------|
| 應用層 | 應用層 + 表現層 + 會議層 |
| 傳輸層 | 傳輸層 |
| 網際網路層 | 網路層 |
| 網路存取層 | 資料連結層 + 實體層 |

**常見混淆澄清**：
- **TCP/IP 模型是實務使用**，OSI 模型是理論參考
- **HTTP 在應用層**，但 HTTPS = HTTP + TLS/SSL (TLS 介於應用層與傳輸層之間)
- **ARP 雖處理 MAC 位址，但運作在網際網路層**

**延伸閱讀**：
- [RFC 1122 - Internet Protocol Suite](https://www.rfc-editor.org/rfc/rfc1122)
- [TCP/IP Illustrated by W. Richard Stevens](https://en.wikipedia.org/wiki/TCP/IP_Illustrated)

---

### 題目 2：子網路切割計算 (Subnetting)

#### 📖 原題 (114年關務特考、身心障礙特考、國軍轉任特考四等)

> **題目**：有一個 Class C 的網段（IP 位址：192.168.10.0/24），若欲將此網段切分為 4 個子網路，請問：
> (一) 每個子網路的子網路遮罩為何？
> (二) 這 4 個子網路的網路位址（Network Address）。
> (三) 每個子網路中可用的主機 IP 位址範圍（Host Range）。
> （每小題 10 分，共 30 分）

#### 🎯 答題架構分析

1. **計算借位**：4 個子網路需要借 2 bits (2^2 = 4)
2. **計算遮罩**：原本 /24，借 2 bits 變 /26
3. **列出網路位址**：每個子網路間隔 64 (2^6)
4. **計算可用 IP**：每子網路 62 個可用主機 (64-2)

#### 📊 評分建議 (預估配分 30 分)

**第一小題（10 分）：子網路遮罩**
- 計算借位數（2 分）
  - 說明 4 個子網路需要 2^2，借 2 bits（2 分）
- 計算新遮罩（5 分）
  - /24 + 2 = /26（2 分）
  - 轉換成十進制：255.255.255.192（3 分）
- 計算過程說明（3 分）

**第二小題（10 分）：4 個子網路的網路位址**
- 計算間隔（2 分）
  - 說明每個子網路大小 = 2^(32-26) = 64（2 分）
- 列出 4 個網路位址（8 分，每個 2 分）
  - 192.168.10.0
  - 192.168.10.64
  - 192.168.10.128
  - 192.168.10.192

**第三小題（10 分）：可用主機 IP 範圍**
- 說明計算原理（2 分）
  - 第一個 IP 是網路位址（不可用）
  - 最後一個 IP 是廣播位址（不可用）
- 列出 4 個子網路的可用範圍（8 分，每個 2 分）
  - 192.168.10.1 ~ 192.168.10.62
  - 192.168.10.65 ~ 192.168.10.126
  - 192.168.10.129 ~ 192.168.10.190
  - 192.168.10.193 ~ 192.168.10.254

**答題提示**：
- ✅ 計算題必須**列出計算過程**，不能只寫答案
- ✅ 遮罩要同時提供 **CIDR (/26) 和十進制格式** (255.255.255.192)
- ✅ 可用 IP 範圍要**扣除網路位址和廣播位址**
- ⚠️ 注意：這是 30 分大題，務必寫詳細

#### ✍️ 標準答案示範

**解答**：

**一、計算子網路遮罩**

**步驟一：確認原始網段資訊**
- 原始網段：**192.168.10.0/24**
- Class C 預設遮罩：**255.255.255.0** (前24位元為網路位元)
- 可用主機位元：32 - 24 = **8 bits**

**步驟二：計算需借用的位元數**
- 需切分成 **4 個子網路**
- 2^n ≥ 4，最小 n = **2**
- 因此需從主機位元借用 **2 bits** 作為子網路位元

**步驟三：計算新的子網路遮罩**
- 原本：/24 (11111111.11111111.11111111.**00000000**)
- 借 2 bits：/26 (11111111.11111111.11111111.**11**000000)
- 十進位表示：**255.255.255.192**

**答案 (一)：每個子網路的遮罩為 255.255.255.192 或 /26**

**二、計算 4 個子網路的網路位址**

**步驟一：計算每個子網路的大小**
- 剩餘主機位元數：8 - 2 = **6 bits**
- 每個子網路包含：2^6 = **64 個 IP 位址**

**步驟二：列出 4 個子網路的網路位址**

| 子網路編號 | 網路位址 | 二進位 (最後一個 Octet) |
|-----------|----------|------------------------|
| 子網路 1 | **192.168.10.0** | 00**00**0000 |
| 子網路 2 | **192.168.10.64** | 01**00**0000 |
| 子網路 3 | **192.168.10.128** | 10**00**0000 |
| 子網路 4 | **192.168.10.192** | 11**00**0000 |

**答案 (二)：192.168.10.0, 192.168.10.64, 192.168.10.128, 192.168.10.192**

**三、計算每個子網路的可用主機 IP 範圍**

**重要觀念**：
- **網路位址 (Network Address)**：每個子網路的第一個 IP，主機位元全為 0，**不可分配給主機**
- **廣播位址 (Broadcast Address)**：每個子網路的最後一個 IP，主機位元全為 1，**不可分配給主機**
- **可用IP範圍**：網路位址+1 ~ 廣播位址-1

**子網路 1：192.168.10.0/26**
- 網路位址：192.168.10.0
- 廣播位址：192.168.10.63
- **可用範圍**：**192.168.10.1 ~ 192.168.10.62** (共 62 個)

**子網路 2：192.168.10. 64/26**
- 網路位址：192.168.10.64
- 廣播位址：192.168.10.127
- **可用範圍**：**192.168.10.65 ~ 192.168.10.126** (共 62 個)

**子網路 3：192.168.10.128/26**
- 網路位址：192.168.10.128
- 廣播位址：192.168.10.191
- **可用範圍**：**192.168.10.129 ~ 192.168.10.190** (共 62 個)

**子網路 4：192.168.10.192/26**
- 網路位址：192.168.10.192
- 廣播位址：192.168.10.255
- **可用範圍**：**192.168.10.193 ~ 192.168.10.254** (共 62 個)

**答案 (三)總結表**：

| 子網路 | 網路位址 | 可用IP範圍 | 廣播位址 |
|-------|----------|-----------|----------|
| 1 | 192.168.10.0 | 192.168.10.1 - 62 | 192.168.10.63 |
| 2 | 192.168.10.64 | 192.168.10.65 - 126 | 192.168.10.127 |
| 3 | 192.168.10.128 | 192.168.10.129 - 190 | 192.168.10.191 |
| 4 | 192.168.10.192 | 192.168.10.193 - 254 | 192.168.10.255 |

**評分標準** (預估)：
- 子網路遮罩計算正確：10分
- 4個網路位址正確：10分
- 可用IP範圍計算正確 (含廣播位址說明)：10分

#### 💡 補充說明

**CIDR 快速對照表**：

| CIDR | 遮罩 | 可用主機數 | 常見用途 |
|------|------|-----------|----------|
| /30 | 255.255.255.252 | 2 | 點對點連線 (Router to Router) |
| /27 | 255.255.255.224 | 30 | 小型辦公室 |
| /26 | 255.255.255.192 | 62 | 中型辦公室 |
| /24 | 255.255.255.0 | 254 | 標準 Class C |
| /23 | 255.255.254.0 | 510 | 大型部門 |
| /16 | 255.255.0.0 | 65534 | 標準 Class B |

**私有IP範圍 (RFC 1918)**：
- **Class A**：10.0.0.0 ~ 10.255.255.255 (/8)
- **Class B**：172.16.0.0 ~ 172.31.255.255 (/12)
- **Class C**：192.168.0.0 ~ 192.168.255.255 (/16)

**子網路切割常見錯誤**：
- 忘記扣除網路位址與廣播位址
- 計算廣播位址時用「下一個網路位址-1」較不易出錯
- /30 只有 2 個可用 IP，常用於點對點連線

**實務工具**：
- 線上計算器：[Subnet Calculator](https://www.subnet-calculator.com/)
- 指令：`ipcalc 192.168.10.0/24` (Linux)

---

### 題目 3：TCP vs UDP 差異與應用

#### 📖 原題 (111年高考三級)

> **題目**：TCP（Transmission Control Protocol）和 UDP（User Datagram Protocol）都位於傳輸層，請說明這兩個協定各自有何特色？（10 分）

#### 🎯 答題架構分析

1. **基本定義**：傳輸層的兩大協定
2. **特色比較**：可靠性、連線、速度、應用
3. **適用情境**：什麼時候用 TCP，什麼時候用 UDP

#### 📊 評分建議 (預估配分 10 分)

**TCP 特色說明（5 分）**：
- 連線導向（Connection-oriented）（1 分）
- 可靠傳輸（三次握手、確認機制）（2 分）
- 流量控制與壅塞控制（1 分）
- 適用場景：HTTP、FTP、Email（1 分）

**UDP 特色說明（5 分）**：
- 無連線（Connectionless）（1 分）
- 不可靠傳輸（無確認機制）（1 分）
- 低延遲、低開銷（1 分）
- 適用場景：DNS、視訊串流、線上遊戲（2 分）

**答題提示**：
- ✅ 必須**對比說明**，不能只寫單方特色
- ✅ 要舉**實際應用案例**加強說明
- ✅ 說明「為什麼」該應用適合用該協定
- ⚠️ 雖然只有 10 分，但要寫出差異性


#### ✍️ 標準答案示範

**解答**：

**一、TCP 與 UDP 定義**

TCP 與 UDP 都是 **OSI 模型第四層 (傳輸層)** 的協定，負責提供**端對端 (End-to-End)** 的資料傳輸服務，但兩者在設計理念與特性上有顯著差異。

**二、TCP (Transmission Control Protocol) 特色**

**1. 連線導向 (Connection-Oriented)**
- 資料傳輸前需先建立連線 (**三方握手, 3-Way Handshake**)
- 傳輸完畢後需關閉連線 (**四次揮手, 4-Way Handshake**)

**2. 可靠傳輸 (Reliable)**
- **確認機制 (Acknowledgment, ACK)**：接收端收到資料後回傳 ACK
- **重傳機制 (Retransmission)**：若逾時未收到 ACK，自動重送
- **保證資料送達**：不會遺失封包

**3. 順序保證 (Ordered Delivery)**
- 資料封包帶有**序號 (Sequence Number)**
- 接收端可依序號重組資料，保證順序正確

**4. 流量控制 (Flow Control)**
- 透過**滑動視窗 (Sliding Window)** 機制
- 防止發送端傳送速度過快，導致接收端緩衝區溢位

**5. 壅塞控制 (Congestion Control)**
- 偵測網路壅塞，動態調整傳送速率
- 演算法：Slow Start, Congestion Avoidance, Fast Retransmit

**6. 額外開銷較大**
- Header 大小：**20-60 Bytes**
- 需維護連線狀態、序號、ACK 等資訊

**適用應用**：
- **HTTP/HTTPS**：網頁瀏覽
- **FTP**：檔案傳輸
- **Email (SMTP, POP3, IMAP)**
- **SSH**：遠端登入

**三、UDP (User Datagram Protocol) 特色**

**1. 無連線 (Connectionless)**
- 不需建立連線，直接傳送資料
- 發送後即「射後不理」

**2. 不可靠傳輸 (Unreliable / Best Effort)**
- **無確認機制**：不確認資料是否送達
- **無重傳機制**：封包遺失就遺失
- **不保證送達**：適合容許少量遺失的應用

**3. 不保證順序**
- 封包可能亂序到達，應用層需自行處理

**4. 無流量控制與壅塞控制**
- 發送端以固定速率傳送，不管接收端或網路狀況

**5. 低延遲、高效率**
- Header 大小：僅 **8 Bytes**
- 無連線建立、無 ACK 等待，傳輸速度快

**6. 支援廣播 (Broadcast) 與多播 (Multicast)**
- TCP 僅支援單播 (Unicast)

**適用應用**：
- **DNS**：網域解析 (查詢封包小，重傳成本低)
- **DHCP**：IP 位址分配
- **串流媒體**：線上影音、直播 (容許少量畫面遺失)
- **線上遊戲**：即時性要求高，容許少量封包遺失
- **VoIP**：網路電話

**四、TCP vs UDP 比較總表**

| 特性 | TCP | UDP |
|------|-----|-----|
| **連線**  | 連線導向 (需握手) | 無連線 (直接傳) |
| **可靠性** | 可靠 (保證送達) | 不可靠 (Best Effort) |
| **順序** | 保證順序 | 不保證 |
| **速度** | 較慢 (額外開銷) | 快速 (低開銷) |
| **Header** | 20-60 Bytes | 8 Bytes |
| **流量控制** | 有 | 無 |
| **壅塞控制** | 有 | 無 |
| **適用** | 要求可靠的應用 | 要求速度的應用 |
| **範例** | HTTP, FTP, Email | DNS, 串流, 遊戲 |

**五、選用原則**

**選擇 TCP 的情境**：
- 資料完整性要求高 (如銀行交易、檔案下載)
- 不可接受資料遺失或錯誤

**選擇 UDP 的情境**：
- 即時性要求高，容許少量遺失 (如視訊會議、遊戲)
- 簡單的請求/回應 (如 DNS 查詢)
- 廣播/多播應用

**評分標準** (預估)：
- TCP 特色說明 (3-4項)：5分
- UDP 特色說明 (3-4項)：5分
- 比較總結或適用情境：額外加分

#### 💡 補充說明

**TCP 三方握手詳細流程**：

```
Client                Server
  |  ----SYN(seq=100)--->  |  (1) Client 發起連線請求
  |  <--SYN-ACK(seq=300, ack=101)-  |  (2) Server 確認並回應
  |  ----ACK(ack=301)--->  |  (3) Client 確認，連線建立
  |                      |
 [連線建立，開始傳輸資料]
```

**TCP 四次揮手 (連線終止)**：

```
Client                Server
  |  ----FIN--->  |  (1) Client 要求關閉
  |  <---ACK----  |  (2) Server 確認
  |  <---FIN----  |  (3) Server 也要求關閉
  |  ----ACK--->  |  (4) Client 確認
```

**常見攻擊**：
- **SYN Flood (TCP)**：大量發送 SYN 不完成握手，耗盡伺服器資源
- **UDP Flood**：大量 UDP 封包淹沒目標，造成 DoS

**新興協定**：
- **QUIC (Quick UDP Internet Connections)**：Google 開發，基於 UDP 但實作類似 TCP 的可靠性，已成為 HTTP/3 基礎
- **目的**：結合 UDP 的速度與 TCP 的可靠性

---

## 【歷年重要題目】104-111年
### 題目 4：DNS 查詢流程

#### 📖 原題 (多次出現在歷年考題)

> **題目**：請說明網域名稱系統（Domain Name System, DNS）的運作原理，並詳細說明當使用者在瀏覽器輸入網址 `www.example.com` 時，完整的 DNS 查詢流程為何？（25分）

#### 🎯 答題架構分析

1. **DNS 定義**：網域名稱系統
2. **查詢流程**：遞迴查詢 vs 迭代查詢
3. **階層結構**：Root → TLD → Authoritative
4. **快取機制**：如何加速查詢

#### 📊 評分建議 (預估配分 25 分)

**DNS 定義與目的（4 分）**：
- 定義：將網域名稱轉換成 IP 位址（2 分）
- 目的：方便記憶、分散式管理（2 分）

**DNS 階層架構（6 分）**：
- Root DNS Server（根伺服器）（2 分）
- TLD DNS Server（頂級網域伺服器）（2 分）
- Authoritative DNS Server（權威伺服器）（2 分）

**DNS 查詢流程（12 分）**：
- 遞迴查詢（Recursive Query）過程（6 分）
  - 用戶端 → Local DNS → 遞迴查詢
- 迭代查詢（Iterative Query）過程（6 分）
  - Local DNS → Root → TLD → Authoritative

**快取機制（3 分）**：
- TTL（Time To Live）機制說明

**答題提示**：
- ✅ 建議**畫圖**說明查詢流程（箭頭清楚標示）
- ✅ 要區分「遞迴」與「迭代」的差異
- ✅ 可舉實際例子：www.google.com 查詢過程
- ⚠️ 這是 25 分大題，務必寫得詳細完整

#### ✍️ 標準答案示範

**解答**：

**一、DNS (Domain Name System) 定義**

DNS 是一套**分散式、階層式**的網域名稱解析系統，主要功能是將**人類易記的網域名稱**(如 www.example.com) 對應 (解析) 成**電腦使用的 IP 位址** (如 93.184.216.34)，使使用者無需記憶複雜的數字位址。

**DNS 特性**：
- **階層式架構**：從根伺服器 → 頂級網域 (TLD) → 權威伺服器
- **分散式管理**：全球數百萬台 DNS 伺服器協同運作
- **快取機制**：減少重複查詢，提升效率
- **使用 UDP Port 53**：查詢封包小，快速回應 (超過512 Bytes 才用 TCP)

**二、DNS 階層架構**

```
        . (根網域, Root)
        |
    ┌───┴───┬─────┬─────┐
   .com   .org   .tw   .uk  (頂級網域, TLD)
    |
  example  (第二層網域, Second-Level Domain)
    |
   www     (子網域, Subdomain / Host)
```

**三、DNS 查詢流程 (查詢 www.example.com)**

**情境**：使用者在瀏覽器輸入 `www.example.com` 並按下 Enter

**步驟一：檢查本機 DNS Cache**
- 作業系統先檢查本機 DNS 快取
- Windows: `ipconfig /displaydns`，Linux: `systemd-resolved` 或 `/etc/hosts`
- 若有快取且未過期 (TTL未到)，直接使用，**流程結束**

**步驟二：查詢本機 ISP Recursive DNS Server (遞迴查詢)**
- 若本機無快取，向 ISP 提供的 DNS 伺服器 (如 Hinet 168.95.1.1) 發送**遞迴查詢 (Recursive Query)**
- 遞迴查詢：要求 DNS 伺服器代為完整查詢，直到得到結果

**步驟三：Recursive DNS 查詢根伺服器 (Root Server) (迭代查詢)**

若 ISP DNS 也無快取，開始進行**迭代查詢 (Iterative Query)**：

1. **查詢根伺服器**：
   - 全球有 **13 組根伺服器** (a.root-servers.net ~ m.root-servers.net)
   - 實際透過 Anycast 技術部署數百台
   - Recursive DNS 問：「www.example.com 的 IP 是？」
   - 根伺服器回答：「我不知道，但管理 .com 的伺服器在 192.5.6.30」

**步驟四：查詢 TLD 伺服器 (.com)**
- Recursive DNS 查詢 **.com TLD 伺服器** (192.5.6.30)
- TLD 伺服器回答：「我不知道 www.example.com，但管理 example.com 的權威伺服器在 93.184.216.34」

**步驟五：查詢 Authoritative Name Server (權威伺服器)**
- Recursive DNS 查詢 **example.com 的權威伺服器** (ns1.example.com)
- 權威伺服器回答：「www.example.com 的 IP 是 **93.184.216.34**」

**步驟六：回傳結果並快取**
- Recursive DNS 收到答案，快取一段時間 (依 TTL 設定)
- 回傳 IP 給使用者電腦
- 使用者電腦也快取此結果
- 瀏覽器使用此 IP 建立 HTTP 連線

**查詢流程圖**：

```
[使用者電腦] --①--> [本機 Cache] (未命中)
    ↓②
[ISP Recursive DNS] --③--> [Root Server (.)]
    ↓④ 回傳 TLD 位址
[ISP Recursive DNS] --⑤--> [TLD Server (.com)]
    ↓⑥ 回傳權威伺服器位址
[ISP Recursive DNS] --⑦--> [Authoritative NS (example.com)]
    ↓⑧ 回傳 IP: 93.184.216.34
[ISP Recursive DNS] --⑨--> [使用者電腦]
```

**四、DNS 記錄類型 (Resource Records)**

| 記錄類型 | 說明 | 範例 |
|---------|------|------|
| **A** | IPv4 位址 | www.example.com → 93.184.216.34 |
| **AAAA** | IPv6 位址 | www.example.com → 2606:2800:220:1:248:1893:25c8:1946 |
| **CNAME** | 別名 | blog.example.com → www.example.com |
| **MX** | 郵件伺服器 | example.com → mail.example.com (Priority 10) |
| **NS** | 名稱伺服器 | example.com → ns1.example.com |
| **TXT** | 文字記錄 | SPF, DKIM等驗證資訊 |

**評分標準** (預估)：
- DNS 定義與特性：5分
- 完整查詢流程 (6-7 步驟)：15分
- DNS 記錄類型補充：5分

#### 💡 補充說明

**DNS 安全威脅**：
- **DNS Spoofing / Cache Poisoning**：攻擊者竄改 DNS 快取，將使用者導向釣魚網站
- **DNS Hijacking**：劫持 DNS 查詢，回傳惡意 IP
- **DNS Amplification DDoS**：利用 DNS 伺服器放大攻擊流量

**DNS 安全強化**：
- **DNSSEC (DNS Security Extensions)**：數位簽章驗證 DNS 回應真實性
- **DNS over HTTPS (DoH)**：加密 DNS 查詢，防止監聽
- **DNS over TLS (DoT)**：類似 DoH

**實務指令**：
- `nslookup www.example.com`：查詢 DNS
- `dig www.example.com +trace`：追蹤完整 DNS 查詢路徑 (Linux/Mac)
- `ipconfig /flushdns`：清除 DNS 快取 (Windows)

---

### 題目 5：NAT 原理與限制

#### 📖 原題 (114年高考三級)

> **題目**：企業常透過網路位址轉譯（Network Address Translation, NAT）技術來節省公有 IP 位址，然而在進行內部服務外部化（例如公開 Web、Mail、VPN 等伺服器）時，NAT 設計可能帶來一些限制或挑戰，請說明兩項限制或挑戰並提出對應的兩種解決方法。（25 分）

#### 🎯 答題架構分析

1. **NAT 定義**：網路位址轉換技術
2. **運作原理**：私有 IP ↔ 公有 IP 轉換
3. **限制/挑戰**：內部服務外部化的問題
4. **解決方法**：Port Forwarding、DMZ 等

#### 📊 評分建議 (預估配分 25 分)

**NAT 定義與運作原理（5 分）**：
- NAT 定義（2 分）
- 運作原理簡述（3 分）

**限制/挑戰 1：無法從外部直接連入內部伺服器（8 分）**：
- 問題說明（4 分）
  - 為什麼外部無法連入（NAT 表項目需內部主動建立）
  - 對 Web/Mail 伺服器的影響
- 解決方法：Port Forwarding（4 分）
  - 原理說明（2 分）
  - 實作範例（2 分）

**限制/挑戰 2：影響 P2P 或需要端對端連線的應用（8 分）**：
- 問題說明（4 分）
  - VPN、P2P、線上遊戲等無法直連
  - NAT Traversal 困難
- 解決方法：DMZ 或 UPnP（4 分）
  - DMZ 原理（2 分）
  - UPnP/NAT-PMP 機制（2 分）

**其他補充（4 分）**：
- Static NAT vs Dynamic NAT 差異
- IPv6 如何解決 NAT 問題

**答題提示**：
- ✅ 每個限制都要**說明問題+提供解決方法**
- ✅ 建議**畫圖**或**舉例**說明 Port Forwarding
- ✅ 可補充實際案例（如架設網站伺服器）
- ⚠️ 這是 25 分大題，兩個限制都要寫得完整

#### ✍️ 標準答案示範

**解答**：

**一、NAT (Network Address Translation) 定義與功能**

**定義**：
NAT 是一種網路技術，將**私有 IP 位址**轉換為**公有 IP 位址**，允許多台內部主機共用少數公有 IP 連接網際網路。

**主要功能**：
1. **節省公有 IP**：解決 IPv4 位址不足問題
2. **隱藏內網架構**：提供一定程度的安全性
3. **彈性管理**：內部 IP 可自由規劃

**NAT 運作原理**：

```
內部主機 (192.168.1.10:5000)
    ↓ 發送封包至 8.8.8.8:53
[NAT Router] 轉換：
  來源 IP: 192.168.1.10 → 203.70.1.1 (公有IP)
  來源 Port: 5000 → 6000 (動態分配)
  建立 NAT 表項目: (192.168.1.10:5000 ↔ 203.70.1.1:6000)
    ↓ 轉發至網際網路
外部伺服器 (8.8.8.8:53) 回應至 203.70.1.1:6000
    ↓ NAT Router 查表轉換回內部
內部主機 (192.168.1.10:5000) 收到回應
```

**二、NAT 在服務外部化時的兩項限制或挑戰**

**限制一：無法主動從外部存取內部伺服器 (Inbound Connection 問題)**

**說明**：
NAT 預設只允許**由內而外**建立的連線。當外部使用者想要存取企業內部的 Web 伺服器 (如 192.168.1.100:80) 時，由於該伺服器使用私有 IP，外部無法直接連線，且 NAT 也無轉譯表項目可供對應。

**情境範例**：
- 企業架設內部 Web 伺服器 (192.168.1.100)
- 外部客戶輸入公司公有 IP (203.70.1.1) 想連到網站
- NAT Router 不知道應將請求轉給哪台內部主機 → **連線失敗**

**限制二：特定協定不相容 (Protocol Limitation)**

**說明**：
某些網路協定在封包的**應用層資料 (Payload)** 中也包含 IP 位址資訊 (如 FTP, SIP)，NAT 僅轉換 IP Header，無法處理應用層的 IP 資訊，導致協定運作異常。

**情境範例**：
- **FTP 主動模式 (Active Mode)**：FTP 控制通道會在資料中傳送內部 IP (如 "PORT 192,168,1,10,20,123")，伺服器收到後嘗試連線至私有 IP → **失敗**
- **VoIP (SIP)**：SIP 訊息中包含 SDP (Session Description Protocol)，內含內部 IP，導致語音串流無法建立

**三、對應的兩種解決方法**

**解決方法一：Port Forwarding (連接埠轉發 / 靜態NAT)**

**原理**：
在 NAT Router 上預先設定**靜態對應規則**，將「特定公有 IP:Port」的連線，固定轉發到「特定內部 IP:Port」。

**設定範例**：

| 公有IP:Port | → | 內部IP:Port | 服務 |
|------------|---|------------|------|
| 203.70.1.1:80 | → | 192.168.1.100:80 | HTTP |
| 203.70.1.1:443 | → | 192.168.1.100:443 | HTTPS |
| 203.70.1.1:25 | → | 192.168.1.200:25 | SMTP Mail |
| 203.70.1.1:1194 | → | 192.168.1.150:1194 | OpenVPN |

**優點**：
- 設定簡單，家用 Router 多支援
- 適合少量服務外部化

**缺點**：
- 每項服務需手動設定
- 同一 Port 只能對應一台內部主機 (如無法同時有兩台 Web 伺服器都使用 Port 80)

**實務操作 (以 iptables 為例)**：

```bash
# 將外部連線 203.70.1.1:80 轉發到內部 192.168.1.100:80
iptables -t nat -A PREROUTING -p tcp -d 203.70.1.1 --dport 80 \
  -j DNAT --to-destination 192.168.1.100:80

iptables -t nat -A POSTROUTING -p tcp -d 192.168.1.100 --dport 80 \
  -j SNAT --to-source 192.168.1.1
```

**解決方法二：DMZ (Demilitarized Zone, 非軍事區)**

**原理**：
將需要對外提供服務的伺服器放置於**獨立的網路區段 (DMZ)**，並設定防火牆規則：
- **外網 → DMZ**：允許特定服務 (如 HTTP/HTTPS)
- **DMZ → 內網**：嚴格限制或禁止
- **內網 → DMZ**：允許管理連線

**網路架構**：

```
             Internet
                |
          [防火牆 Firewall]
         /              \
       DMZ              內網 (Intranet)
        |                 |
  [Web Server]     [內部資料庫]
  [Mail Server]    [員工電腦]
  公有IP或映射       私有IP
```

**優點**：
- **安全性高**：即使 DMZ 伺服器被攻陷，攻擊者仍無法直接存取內網
- **適合多服務**：可放置多台對外伺服器

**缺點**：
- 需要額外網路設備 (如第三個網路介面的防火牆)
- 管理複雜度較高

**額外解決方案 (補充)**：

**方法三：Application Layer Gateway (ALG) / NAT Helper**
- 針對 FTP, SIP 等協定，NAT Router 實作協定解析器，自動修正應用層的 IP 資訊
- 家用 Router 通常內建 FTP ALG, PPTP ALG

**方法四：遷移至 IPv6**
- IPv6 位址充足 (2^128 個)，每台設備都可擁有公有 IP
- **不需 NAT**，真正的端對端 (End-to-End) 通訊
- 但需硬體與軟體全面支援

**評分標準** (預估)：
- NAT 定義與運作原理：5分
- 限制一說明 (Inbound Connection)：5分
- 限制二說明 (Protocol Compatibility)：5分
- 解決方法一 (Port Forwarding)：5分
- 解決方法二 (DMZ)：5分

#### 💡 補充說明

**NAT 類型**：
1. **Static NAT (一對一)**：一個公有 IP 固定對應一個私有 IP
2. **Dynamic NAT (多對多)**：多個公有 IP 動態分配給內部主機
3. **PAT (Port Address Translation, 多對一, NAT Overload)**：最常見，多個私有 IP 共用一個公有 IP，透過 Port 區分

**NAT 穿透技術 (NAT Traversal)**：
- **STUN (Session Traversal Utilities for NAT)**：讓內部主機發現自己的公有 IP 與 Port
- **TURN (Traversal Using Relays around NAT)**：透過中繼伺服器轉發流量
- **ICE (Interactive Connectivity Establishment)**：結合 STUN 與 TURN，用於 WebRTC

**為何需要 IPv6**：
- IPv4 已耗盡 (2011年完全分配)
- NAT 破壞端對端原則，增加複雜度
- IPv6 位址：2^128 = 340兆兆兆個 (每粒沙都能分配IP)

---

## 🗂️ 歷屆精選題庫 (Selected Question Bank)

### TCP/IP 協定疊與OSI模型
1. **114年關務特考三等**：Internet 通訊協定疊各層服務與協定
2. **113年地方特考三等**：OSI 七層模型與封裝過程
3. **111年高考三級**：TCP/IP 模型與 OSI 模型對應關係

### 子網路切割
4. **114年關務特考四等**：Class C 網段切分為 4 個子網路計算
5. **113年地方特考四等**：CIDR `/27` 的可用主機數與廣播位址
6. **112年普考**：不規則子網路切割 (VLSM)

### 傳輸層協定
7. **111年高考三級**：TCP 與 UDP 特色比較
8. **111年高考三級**：TCP 三方握手與 SYN Flood 攻擊
9. **110年高考三級**：TCP 流量控制與壅塞控制機制

### 應用層協定
10. **110年普考**：DNS 完整查詢流程與記錄類型
11. **109年高考三級**：DHCP 四步驟 (DORA) 運作原理
12. **114年關務特考三等**：SSL/TLS 握手過程與對稱/非對稱加密角色

### NAT與IP定址
13. **114年高考三級**：NAT 服務外部化限制與解決方法
14. **111年高考三級**：NAT 原理與安全性考量
15. **113年高考二級**：IPv4 與 IPv6 差異及遷移挑戰

### 網路設備與架構
16. **114年關務特考四等**：Switch vs Hub 差異, Router 功能, NIC 作用
17. **113年地方特考三等**：負載平衡演算法與 Session Stickiness
18. **112年高考三級**：VLAN 原理與優點

### 新興技術
19. **114年高考三級**：SDN 三層架構與對傳統網路的影響
20. **113年高考二級**：5G 網路切片 (Network Slicing) 與應用

---

## 💡 答題技巧總結

1. **畫圖加分**：網路類題目善用流程圖、架構圖、封包格式圖
2. **計算要詳細**：子網路切割題務必寫出計算過程，不要只寫答案
3. **舉例說明**：抽象概念用實際應用舉例 (如「TCP用於網頁瀏覽」)
4. **記住關鍵數字**：TCP Header 20 Bytes, UDP 8 Bytes, /24=254 hosts
5. **分層思考**：網路問題從 OSI/TCP-IP 分層角度分析
6. **安全考量**：即使問協定原理，也可補充安全威脅與防護

---

## 🔗 參考資源

- [RFC 791 - Internet Protocol (IP)](https://www.rfc-editor.org/rfc/rfc791)
- [RFC 793 - Transmission Control Protocol (TCP)](https://www.rfc-editor.org/rfc/rfc793)
- [RFC 768 - User Datagram Protocol (UDP)](https://www.rfc-editor.org/rfc/rfc768)
- [RFC 1035 - Domain Names (DNS)](https://www.rfc-editor.org/rfc/rfc1035)
- [RFC 1918 - Private IP Address Allocation](https://www.rfc-editor.org/rfc/rfc1918)
- [Subnet Calculator](https://www.subnet-calculator.com/) - 線上子網路計算器
- [IANA - Internet Assigned Numbers Authority](https://www.iana.org/) - 官方協定編號資料庫
